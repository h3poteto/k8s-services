---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: metallb
  namespace: flux-system
spec:
  interval: 1m
  targetNamespace: metallb
  chart:
    spec:
      chart: metallb
      version: '0.13.10'
      sourceRef:
        kind: HelmRepository
        name: metallb
        namespace: flux-system
      interval: 1m
  values:
    speaker:
      tolerateMaster: false
      logLevel: "debug"
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: external-secrets
  namespace: flux-system
spec:
  interval: 1m
  targetNamespace: kube-system
  chart:
    spec:
      chart: external-secrets
      version: '0.9.1'
      sourceRef:
        kind: HelmRepository
        name: external-secrets
        namespace: flux-system
      interval: 1m
  values:
    installCRDs: true
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: longhorn
  namespace: flux-system
spec:
  interval: 1m
  targetNamespace: longhorn-system
  chart:
    spec:
      chart: longhorn
      version: '1.4.2'
      sourceRef:
        kind: HelmRepository
        name: longhorn
        namespace: flux-system
      interval: 1m
  values:
    service:
      ui:
        type: LoadBalancer
---
# apiVersion: helm.toolkit.fluxcd.io/v2beta1
# kind: HelmRelease
# metadata:
#   name: prometheus
#   namespace: flux-system
# spec:
#   interval: 1m
#   targetNamespace: monitoring
#   chart:
#     spec:
#       chart: prometheus
#       version: '23.1.0'
#       sourceRef:
#         kind: HelmRepository
#         name: prometheus-community
#         namespace: flux-system
#       interval: 1m
#   values:
#     alertmanager:
#       enabled: false
#     prometheus-pushgateway:
#       enabled: false
#     server:
#       ingress:
#         enabled: false
#       service:
#         enabled: true
#         type: LoadBalancer
#       persistentVolume:
#         enabled: true
#         storageClass: longhorn
---
# apiVersion: helm.toolkit.fluxcd.io/v2beta1
# kind: HelmRelease
# metadata:
#   name: grafana
#   namespace: flux-system
# spec:
#   interval: 1m
#   targetNamespace: monitoring
#   chart:
#     spec:
#       chart: grafana
#       version: '6.58.2'
#       sourceRef:
#         kind: HelmRepository
#         name: grafana
#         namespace: flux-system
#       interval: 1m
#   values:
#     service:
#       enabled: true
#       type: LoadBalancer
#     ingress:
#       enabled: false
#     persistence:
#       enabled: true
#       type: pvc
#       storageClassName: longhorn
#     admin:
#       existingSecret: "grafana-env"
#       userKey: "ADMIN_USER"
#       passwordKey: "ADMIN_PASSWORD"
#     datasources:
#       datasources.yaml:
#         apiVersion: 1
#         datasources:
#           - name: Prometheus
#             type: prometheus
#             access: proxy
#             url: http://monitoring-prometheus-server.monitoring.svc.cluster.local
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: sealed-secrets
  namespace: flux-system
spec:
  interval: 1m
  targetNamespace: kube-system
  chart:
    spec:
      chart: sealed-secrets
      version: '2.10.0'
      sourceRef:
        kind: HelmRepository
        name: sealed-secrets
        namespace: flux-system
      interval: 1m
