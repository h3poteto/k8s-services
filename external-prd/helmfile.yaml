repositories:
  - name: stable
    url: https://charts.helm.sh/stable
  - name: incubator
    url: https://charts.helm.sh/incubator
  - name: h3poteto-stable
    url: https://h3poteto.github.io/charts/stable
  - name: kube-state-metrics
    url: https://kubernetes.github.io/kube-state-metrics
  - name: prometheus-community
    url: https://prometheus-community.github.io/helm-charts
  - name: eks
    url: https://aws.github.io/eks-charts
  - name: jetstack
    url: https://charts.jetstack.io
  - name: external-secrets
    url: https://charts.external-secrets.io

releases:
  - name: external-secrets-operator
    namespace: kube-system
    chart: external-secrets/external-secrets
    version: 0.5.9
    values:
      - installCRDs: true
  - name: aws-load-balancer-controller
    namespace: kube-system
    chart: eks/aws-load-balancer-controller
    version: 1.4.3
    values:
      - clusterName: external-prd-20220509.k8s.h3poteto.dev
      - serviceAccount:
          create: true
          annotations:
            eks.amazonaws.com/role-arn: arn:aws:iam::564677439943:role/alb-ingress-controller-role
      - rbac:
          create: true
      - region: ap-northeast-1
      - vpcId: vpc-fb354b9c
  - name: prometheus-node-exporter
    namespace: monitoring
    chart: prometheus-community/prometheus-node-exporter
    version: 3.3.1
    values:
      - rbac:
          create: true
          pspEnabled: true
      - podLabels:
          prometheus.io/scrape: 'true'
          prometheus.io/port: '9100'
      - service:
          type: ClusterIP
          port: 9100
  - name: kube-state-metrics
    namespace: monitoring
    chart: kube-state-metrics/kube-state-metrics
    version: 2.13.3
    values:
      - rbac:
          create: true
      - service:
          port: 8080
      - podAnnotations:
          prometheus.io/scrape: 'true'
          prometheus.io/port: '8080'
  - name: kms-secrets
    namespace: kube-system
    chart: h3poteto-stable/kms-secrets
    version: 0.1.7
    values:
      - rbac:
          create: true
          serviceAccount:
            annotations:
              eks.amazonaws.com/role-arn: arn:aws:iam::564677439943:role/kms-secrets-role
  - name: node-manager
    namespace: kube-system
    chart: h3poteto-stable/node-manager
    version: 0.3.3
    values:
      - rbac:
          create: true
          serviceAccount:
            annotations:
              eks.amazonaws.com/role-arn: arn:aws:iam::564677439943:role/node-manager-controller-role
      - nodemanager:
          aws:
            region: ap-northeast-1
            masters:
              desired: 3
              asgModifyCoolTimeSeconds: 300
              drainGracePeriodSeconds: 300
              refreshSchedule: "00 15 * * 5"
              surplusNodes: 0
              enableReplenish: true
              autoScalingGroups:
                - name: master-ap-northeast-1a.masters.external-prd-20220509.k8s.h3poteto.dev
                - name: master-ap-northeast-1c.masters.external-prd-20220509.k8s.h3poteto.dev
                - name: master-ap-northeast-1d.masters.external-prd-20220509.k8s.h3poteto.dev
            workers:
              desired: 3
              asgModifyCoolTimeSeconds: 300
              drainGracePeriodSeconds: 300
              refreshSchedule: "00 15 * * 6"
              surplusNodes: 1
              enableReplenish: true
              autoScalingGroups:
                - name: nodes-ap-northeast-1a.external-prd-20220509.k8s.h3poteto.dev
                - name: nodes-ap-northeast-1c.external-prd-20220509.k8s.h3poteto.dev
                - name: nodes-ap-northeast-1d.external-prd-20220509.k8s.h3poteto.dev
